name: Tests

on: [push, pull_request]

jobs:
    quality:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Set up Python 3.11
              uses: actions/setup-python@v4
              with:
                  python-version: 3.11

            - name: Install Poetry
              run: |
                  curl -sSL https://install.python-poetry.org | python3 -
                  export PATH="$HOME/.local/bin:$PATH"

            - name: Install dependencies
              run: |
                  poetry install

            - name: Run Ruff
              run: poetry run ruff .

    tests:
        runs-on: ubuntu-latest

        needs: quality

        strategy:
            matrix:
                python-version: ["3.11", "3.12"]
                django-version: ["4.2", "5.0"]

        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Set up Python ${{ matrix.python-version }}
              uses: actions/setup-python@v4
              with:
                  python-version: ${{ matrix.python-version }}

            - name: Install Poetry
              run: |
                  curl -sSL https://install.python-poetry.org | python3 -
                  export PATH="$HOME/.local/bin:$PATH"

            - name: Install dependencies
              run: |
                  poetry install

            - name: Run tests
              run: poetry run pytest
